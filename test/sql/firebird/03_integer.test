# name: test/sql/firebird/03_integer.test
# description: test for Firebird INTEGER types (SMALLINT, INTEGER, BIGINT)
# group: [firebird_integer]

require odbc_scanner

statement ok
SET VARIABLE conn = odbc_connect('ODBCSCANNER_DEBUG_CONN_STRING_ENV_VAR=ODBC_CONN_STRING')

# SMALLINT test
query I
SELECT * FROM odbc_query(getvariable('conn'), 'SELECT CAST(100 AS SMALLINT) FROM rdb$database')
----
100

query I
SELECT column_type from (
  DESCRIBE SELECT * FROM odbc_query(getvariable('conn'), 'SELECT CAST(42 AS SMALLINT) FROM rdb$database')
)
----
SMALLINT

query I
SELECT * FROM odbc_query(getvariable('conn'), 'SELECT CAST(42 AS SMALLINT) FROM rdb$database',
  enable_columns_binding=TRUE)
----
42

query I
SELECT * FROM odbc_query(getvariable('conn'), 'SELECT CAST(-32768 AS SMALLINT) FROM rdb$database')
----
-32768

query I
SELECT * FROM odbc_query(getvariable('conn'), 'SELECT CAST(32767 AS SMALLINT) FROM rdb$database')
----
32767

# SMALLINT with parameters
query I
SELECT * FROM odbc_query(getvariable('conn'), 'SELECT CAST(? AS SMALLINT) FROM rdb$database', params=row(42::SMALLINT))
----
42

# INTEGER test
query I
SELECT * FROM odbc_query(getvariable('conn'), 'SELECT CAST(123456 AS INTEGER) FROM rdb$database')
----
123456

query I
SELECT column_type from (
  DESCRIBE SELECT * FROM odbc_query(getvariable('conn'), 'SELECT CAST(42 AS INTEGER) FROM rdb$database')
)
----
INTEGER

query I
SELECT * FROM odbc_query(getvariable('conn'), 'SELECT CAST(42 AS INTEGER) FROM rdb$database',
  enable_columns_binding=TRUE)
----
42

query I
SELECT * FROM odbc_query(getvariable('conn'), 'SELECT CAST(-2147483648 AS INTEGER) FROM rdb$database')
----
-2147483648

query I
SELECT * FROM odbc_query(getvariable('conn'), 'SELECT CAST(2147483647 AS INTEGER) FROM rdb$database')
----
2147483647

# BIGINT test
query I
SELECT * FROM odbc_query(getvariable('conn'), 'SELECT CAST(9223372036854775807 AS BIGINT) FROM rdb$database')
----
9223372036854775807

query I
SELECT * FROM odbc_query(getvariable('conn'), 'SELECT CAST(-9223372036854775808 AS BIGINT) FROM rdb$database')
----
-9223372036854775808

# Hexadecimal format test for INTEGER
query I
SELECT * FROM odbc_query(getvariable('conn'), 'SELECT 0x7FFFFFFF FROM rdb$database')
----
2147483647

# Hexadecimal format test for BIGINT  
query I
SELECT * FROM odbc_query(getvariable('conn'), 'SELECT 0x7FFFFFFFFFFFFFFF FROM rdb$database')
----
9223372036854775807

# NULL values
query I
SELECT * FROM odbc_query(getvariable('conn'), 'SELECT CAST(NULL AS INTEGER) FROM rdb$database')
----
NULL

# With parameters
query I
SELECT * FROM odbc_query(getvariable('conn'), 
  'SELECT CAST(? AS INTEGER) FROM rdb$database',
  params=row(42::INTEGER))
----
42

# Prepared parameter binding (SMALLINT)
statement ok
SET VARIABLE params_smallint = odbc_create_params()

statement ok
PREPARE p_smallint AS SELECT * FROM odbc_query(getvariable('conn'), 'SELECT CAST(? AS SMALLINT) FROM rdb$database', params_handle=getvariable('params_smallint'))

statement ok
PREPARE p_smallint_bind AS SELECT odbc_bind_params(getvariable('conn'), getvariable('params_smallint'), row(?))

statement ok
EXECUTE p_smallint_bind(32767::SMALLINT)

query I
EXECUTE p_smallint
----
32767

statement ok
DEALLOCATE p_smallint_bind

statement ok
DEALLOCATE p_smallint

# Prepared parameter binding (INTEGER)
statement ok
SET VARIABLE params_integer = odbc_create_params()

statement ok
PREPARE p_integer AS SELECT * FROM odbc_query(getvariable('conn'), 'SELECT CAST(? AS INTEGER) FROM rdb$database', params_handle=getvariable('params_integer'))

statement ok
PREPARE p_integer_bind AS SELECT odbc_bind_params(getvariable('conn'), getvariable('params_integer'), row(?))

statement ok
EXECUTE p_integer_bind(2147483647::INTEGER)

query I
EXECUTE p_integer
----
2147483647

statement ok
DEALLOCATE p_integer_bind

statement ok
DEALLOCATE p_integer

# Note: INT128 type requires Firebird 4.0+ and is not tested here
# INT128 range: -2^127 to 2^127-1

statement ok
SELECT odbc_close(getvariable('conn'))
