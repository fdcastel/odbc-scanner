# name: test/sql/duckdb/query_basic.test
# description: basic test for odbc_query() function with DuckDB
# group: [duckdb_query_basic]

statement error
SELECT * FROM odbc_query()
----
Catalog Error: Table Function with name odbc_query does not exist!

require odbc_scanner

statement error
SELECT * FROM odbc_query()
----
<REGEX>:.*Binder Error: No function matches the given name and argument types 'odbc_query\(\)'.*

statement error
SELECT * FROM odbc_query(NULL, 'SELECT 42')
----
Binder Error: 'odbc_query' error: specified ODBC connection must be not NULL

statement error
SELECT * FROM odbc_query(getvariable('fail'), 'SELECT 42')
----
Binder Error: 'odbc_query' error: specified ODBC connection must be not NULL

statement error
SELECT * FROM odbc_query(42::BIGINT, 'SELECT 42')
----
Binder Error: 'odbc_query' error: ODBC connection not found on bind, id: 42

statement error
SELECT * FROM odbc_query(42::FLOAT, 'SELECT 42')
----
Binder Error: 'odbc_query' error: invalid first argument specified, type ID: 10

statement ok
SET VARIABLE conn = odbc_connect('ODBCSCANNER_DEBUG_CONN_STRING_ENV_VAR=ODBC_CONN_STRING')

statement error
SELECT * FROM odbc_query(getvariable('conn'), NULL)
----
Binder Error: 'odbc_query' error: specified SQL query must be not NULL

statement error
SELECT * FROM odbc_query(getvariable('conn'), 'FAIL')
----
<REGEX>:.*Binder Error:.*FAIL.*

query II
SELECT * FROM odbc_query(getvariable('conn'), 'SELECT 42, ''foo'' UNION ALL SELECT 43, ''bar'' ORDER BY 1')
----
42	foo
43	bar

query II
SELECT column_name, column_type from (
  DESCRIBE SELECT * FROM odbc_query(getvariable('conn'), 'SELECT 42 AS col1, ''foo'' AS col2')
)
----
col1	INTEGER
col2	VARCHAR

query I
SELECT * FROM odbc_query(getvariable('conn'), 'SELECT NULL')
----
NULL

query I
SELECT * FROM odbc_query(getvariable('conn'), 'SELECT NULL::INTEGER')
----
NULL

statement ok
SELECT odbc_close(getvariable('conn'))
