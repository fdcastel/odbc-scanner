# name: test/sql/query_params.test
# description: test for calls of odbc_query() function with params argument
# group: [sql_query_params]

require odbc_scanner

statement ok
SET VARIABLE conn = odbc_connect('ODBCSCANNER_DEBUG_CONN_STRING_ENV_VAR=ODBC_CONN_STRING')

statement error
SELECT * FROM odbc_query(getvariable('conn'), 'SELECT CAST(? AS INTEGER)', params=NULL)
----
Binder Error: Cannot extract parameters from STRUCT: specified STRUCT is NULL

statement error
SELECT * FROM odbc_query(getvariable('conn'), 'SELECT CAST(? AS INTEGER)', params=42)
----
Binder Error: Cannot extract parameters from STRUCT: specified value is not STRUCT

query I
SELECT * FROM odbc_query(getvariable('conn'), 'SELECT CAST(? AS INTEGER)', params=row(42))
----
42

# statement error
# SELECT * FROM odbc_query(getvariable('conn'), 'SELECT CAST(? AS INTEGER)', params=row('foo'))
# ----
# Invalid Input Error: 'SQLExecute' failed, query: 'SELECT CAST(? AS INTEGER)'

statement error
SELECT * FROM odbc_query(getvariable('conn'), 'SELECT CAST(? AS INTEGER)', params=row(41, 42))
----
Binder Error: Incorrect number of parameters specified, query: 'SELECT CAST(? AS INTEGER)', expected: 1, actual: 2

query I
SELECT * FROM odbc_query(getvariable('conn'), 'SELECT CAST(? AS INTEGER)', params=row(NULL))
----
NULL

statement ok
PREPARE p1 AS SELECT * FROM odbc_query(getvariable('conn'), 'SELECT CAST(? AS INTEGER)', params=row(?))

query I
EXECUTE p1(42)
----
42

query I
EXECUTE p1(43)
----
43

statement ok
DEALLOCATE p1

statement ok
SELECT odbc_close(getvariable('conn'))
